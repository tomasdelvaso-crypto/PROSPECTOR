<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ventapel Prospector Pro - Sistema Company-First</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <nav class="bg-gradient-to-r from-blue-900 to-indigo-800 shadow-xl">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-5">
                <div>
                    <h1 class="text-3xl font-bold text-white">Ventapel Prospector Pro</h1>
                    <p class="text-sm text-blue-200">Company-First Intelligence System</p>
                </div>
                <div class="flex gap-2">
                    <span class="bg-green-500 px-3 py-1 rounded-full text-white text-xs font-semibold">Apollo.io</span>
                    <span class="bg-yellow-500 px-3 py-1 rounded-full text-white text-xs font-semibold">Lusha</span>
                    <span class="bg-purple-500 px-3 py-1 rounded-full text-white text-xs font-semibold">Serper</span>
                    <span class="bg-red-500 px-3 py-1 rounded-full text-white text-xs font-semibold">Claude AI</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="max-w-7xl mx-auto px-4 py-6">
        
        <!-- Workflow Steps Indicator -->
        <div class="bg-white rounded-lg shadow-md p-4 mb-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-8">
                    <div class="flex items-center" id="step1-indicator">
                        <div class="w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">1</div>
                        <span class="ml-2 font-semibold">Buscar Empresas</span>
                    </div>
                    <div class="text-gray-400">‚Üí</div>
                    <div class="flex items-center opacity-50" id="step2-indicator">
                        <div class="w-10 h-10 bg-gray-300 text-white rounded-full flex items-center justify-center font-bold">2</div>
                        <span class="ml-2 font-semibold text-gray-500">Encontrar Decisores</span>
                    </div>
                    <div class="text-gray-400">‚Üí</div>
                    <div class="flex items-center opacity-50" id="step3-indicator">
                        <div class="w-10 h-10 bg-gray-300 text-white rounded-full flex items-center justify-center font-bold">3</div>
                        <span class="ml-2 font-semibold text-gray-500">An√°lise Profunda</span>
                    </div>
                </div>
                <div id="credits-counter" class="text-sm text-gray-600">
                    <i class="fas fa-coins mr-1"></i>
                    <span id="credits-used">0</span> cr√©ditos usados
                </div>
            </div>
        </div>

        <!-- Step 1: Company Search -->
        <div id="step1-panel" class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">
                <i class="fas fa-building mr-2 text-blue-600"></i>
                Passo 1: Buscar Empresas Target
            </h2>
            
            <div class="grid grid-cols-4 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-semibold mb-1 text-gray-700">
                        üè≠ Setor/Palavras-chave
                    </label>
                    <input type="text" 
                           id="keywordsFilter" 
                           class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none"
                           placeholder="logistica, ecommerce, manufactura"
                           value="logistica, fulfillment, warehouse">
                </div>
                
                <div>
                    <label class="block text-sm font-semibold mb-1 text-gray-700">
                        üìç Localiza√ß√£o
                    </label>
                    <select id="locationFilter" 
                            class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none">
                        <option value="Brazil">Brasil (Todo)</option>
                        <option value="S√£o Paulo, Brazil">S√£o Paulo</option>
                        <option value="Rio de Janeiro, Brazil">Rio de Janeiro</option>
                        <option value="Santa Catarina, Brazil" selected>Santa Catarina</option>
                        <option value="Paran√°, Brazil">Paran√°</option>
                        <option value="Minas Gerais, Brazil">Minas Gerais</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-semibold mb-1 text-gray-700">
                        üë• Porte (Funcion√°rios)
                    </label>
                    <select id="sizeFilter" 
                            class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none">
                        <option value="">Todos os Portes</option>
                        <option value="100,500">100-500</option>
                        <option value="501,1000" selected>501-1000</option>
                        <option value="1001,5000">1001-5000</option>
                        <option value="5001,10000">5001+</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-semibold mb-1 text-gray-700">
                        üíº Perfil de Decisor
                    </label>
                    <select id="titleProfile" 
                            class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none">
                        <option value="operations" selected>Opera√ß√µes/Log√≠stica</option>
                        <option value="quality">Qualidade/Produ√ß√£o</option>
                        <option value="directors">Diretoria</option>
                        <option value="c_level">C-Level</option>
                    </select>
                </div>
            </div>
            
            <div class="flex gap-3">
                <button onclick="searchCompanies()" 
                        class="px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 font-semibold shadow-lg transition-all duration-200 transform hover:scale-105">
                    <i class="fas fa-search mr-2"></i>Buscar Empresas Qualificadas
                </button>
                
                <button onclick="clearAll()" 
                        class="px-4 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-all duration-200">
                    <i class="fas fa-eraser mr-2"></i>Limpar
                </button>
                
                <button onclick="exportResults()" 
                        class="px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all duration-200">
                    <i class="fas fa-download mr-2"></i>Exportar CSV
                </button>
            </div>
        </div>

        <!-- Companies Results -->
        <div id="companies-container" class="hidden">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">
                        <span id="companies-count">0</span> Empresas Encontradas
                    </h3>
                    <div class="text-sm text-gray-600">
                        <i class="fas fa-info-circle mr-1"></i>
                        Clique em "Ver Decisores" para encontrar contatos
                    </div>
                </div>
                <div id="companies-list" class="space-y-4">
                    <!-- Companies will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Loading States -->
        <div id="loading-companies" class="hidden">
            <div class="bg-blue-50 rounded-lg p-8 text-center">
                <i class="fas fa-spinner fa-spin text-4xl text-blue-600 mb-4"></i>
                <p class="text-lg font-semibold text-blue-800">Buscando empresas qualificadas...</p>
                <p class="text-sm text-blue-600 mt-2">Analisando ind√∫stria, localiza√ß√£o e porte</p>
            </div>
        </div>
    </div>

    <!-- Modal for Contact Analysis -->
    <div id="contactModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto m-4">
            <div class="sticky top-0 bg-white border-b p-4 flex justify-between items-center">
                <h3 class="text-xl font-bold">An√°lise de Decisores</h3>
                <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div id="modal-content" class="p-6">
                <!-- Contact details will be inserted here -->
            </div>
        </div>
    </div>

<script>
// Global state
let currentCompanies = [];
let currentContacts = {};
let creditsUsed = 0;
let analysisResults = {};

// Title profiles mapping
const TITLE_PROFILES = {
    'operations': {
        titles: ['Operations Manager', 'Logistics Manager', 'Supply Chain Manager', 'Warehouse Manager'],
        seniorities: ['manager', 'director', 'head', 'vp']
    },
    'quality': {
        titles: ['Quality Manager', 'Production Manager', 'Plant Manager'],
        seniorities: ['manager', 'director', 'head']
    },
    'directors': {
        titles: [],
        seniorities: ['director', 'vp', 'head']
    },
    'c_level': {
        titles: ['COO', 'CEO', 'CFO'],
        seniorities: ['c_suite', 'owner', 'founder']
    }
};

// Step 1: Search Companies
async function searchCompanies() {
    const loadingDiv = document.getElementById('loading-companies');
    const companiesContainer = document.getElementById('companies-container');
    
    loadingDiv.classList.remove('hidden');
    companiesContainer.classList.add('hidden');
    
    const filters = {
        keywords: document.getElementById('keywordsFilter').value.split(',').map(k => k.trim()).filter(Boolean),
        location: document.getElementById('locationFilter').value,
        size: document.getElementById('sizeFilter').value
    };
    
    try {
        const response = await fetch('/api/1-search-companies', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ filters })
        });
        
        const data = await response.json();
        currentCompanies = data.organizations || [];
        displayCompanies(currentCompanies);
        
    } catch (error) {
        console.error('Error searching companies:', error);
        alert('Erro ao buscar empresas. Verifique o console.');
    } finally {
        loadingDiv.classList.add('hidden');
    }
}

// Display companies
function displayCompanies(companies) {
    const container = document.getElementById('companies-container');
    const listDiv = document.getElementById('companies-list');
    const countSpan = document.getElementById('companies-count');
    
    if (companies.length === 0) {
        listDiv.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhuma empresa encontrada</p>';
        container.classList.remove('hidden');
        return;
    }
    
    countSpan.textContent = companies.length;
    
    let html = '';
    companies.forEach((company, idx) => {
        const boxesEstimate = estimateBoxesPerDay(company);
        const priority = boxesEstimate > 1000 ? 'HIGH' : boxesEstimate > 500 ? 'MEDIUM' : 'LOW';
        const priorityColor = priority === 'HIGH' ? 'green' : priority === 'MEDIUM' ? 'yellow' : 'gray';
        
        html += `
            <div class="border rounded-lg p-4 hover:shadow-md transition-shadow" id="company-${idx}">
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-2">
                            <h4 class="text-lg font-bold text-gray-800">${company.name}</h4>
                            <span class="px-2 py-1 bg-${priorityColor}-100 text-${priorityColor}-700 rounded-full text-xs font-semibold">
                                ${priority} - ~${boxesEstimate} caixas/dia
                            </span>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-2 text-sm text-gray-600">
                            <p><i class="fas fa-industry fa-fw mr-1"></i>${company.industry || 'N√£o especificado'}</p>
                            <p><i class="fas fa-users fa-fw mr-1"></i>${company.estimated_num_employees || 'N/A'} funcion√°rios</p>
                            <p><i class="fas fa-map-marker-alt fa-fw mr-1"></i>${company.city || company.state || 'Brasil'}</p>
                            <p><i class="fas fa-globe fa-fw mr-1"></i>
                                ${company.website_url ? `<a href="${company.website_url}" target="_blank" class="text-blue-600 hover:underline">${company.primary_domain}</a>` : 'N/A'}
                            </p>
                        </div>
                    </div>
                    
                    <button onclick="findContacts('${company.id}', ${idx})" 
                            class="px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 font-semibold transition-all">
                        <i class="fas fa-user-tie mr-2"></i>Ver Decisores
                    </button>
                </div>
                
                <div id="contacts-${idx}" class="mt-4 hidden">
                    <!-- Contacts will be loaded here -->
                </div>
            </div>
        `;
    });
    
    listDiv.innerHTML = html;
    container.classList.remove('hidden');
    updateStepIndicator(1);
}

// Step 2: Find Contacts
async function findContacts(companyId, companyIdx) {
    const contactsDiv = document.getElementById(`contacts-${companyIdx}`);
    contactsDiv.classList.remove('hidden');
    contactsDiv.innerHTML = '<p class="text-indigo-600"><i class="fas fa-spinner fa-spin mr-2"></i>Buscando decisores...</p>';
    
    const profile = document.getElementById('titleProfile').value;
    const { titles, seniorities } = TITLE_PROFILES[profile];
    
    try {
        const response = await fetch('/api/2-find-contacts', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                organizationId: companyId,
                titles,
                seniorities
            })
        });
        
        const data = await response.json();
        currentContacts[companyIdx] = data.people || [];
        displayContactsInCompany(currentContacts[companyIdx], companyIdx);
        updateStepIndicator(2);
        
    } catch (error) {
        console.error('Error finding contacts:', error);
        contactsDiv.innerHTML = '<p class="text-red-600">Erro ao buscar contatos</p>';
    }
}

// Display contacts within company card
function displayContactsInCompany(contacts, companyIdx) {
    const contactsDiv = document.getElementById(`contacts-${companyIdx}`);
    
    if (contacts.length === 0) {
        contactsDiv.innerHTML = '<p class="text-gray-500">Nenhum decisor encontrado com este perfil</p>';
        return;
    }
    
    let html = '<div class="border-t pt-3 mt-3"><p class="font-semibold mb-3">Decisores Encontrados:</p><div class="grid grid-cols-2 gap-3">';
    
    contacts.forEach((contact, contactIdx) => {
        const uniqueId = `${companyIdx}-${contactIdx}`;
        html += `
            <div class="border rounded-lg p-3 bg-gray-50">
                <p class="font-semibold text-sm">${contact.name}</p>
                <p class="text-xs text-gray-600 mb-2">${contact.title || 'Cargo n√£o especificado'}</p>
                
                <div class="flex gap-2">
                    ${contact.linkedin_url ? `
                        <a href="${contact.linkedin_url}" target="_blank" 
                           class="flex-1 px-2 py-1 bg-blue-600 text-white rounded text-xs text-center hover:bg-blue-700">
                            <i class="fab fa-linkedin mr-1"></i>LinkedIn
                        </a>
                    ` : ''}
                    <button onclick="openAnalysisModal('${uniqueId}')" 
                            class="flex-1 px-2 py-1 bg-purple-600 text-white rounded text-xs hover:bg-purple-700 font-semibold">
                        <i class="fas fa-microscope mr-1"></i>Analisar
                    </button>
                </div>
            </div>
        `;
    });
    
    html += '</div></div>';
    contactsDiv.innerHTML = html;
}

// Open modal for deep analysis
function openAnalysisModal(uniqueId) {
    const [companyIdx, contactIdx] = uniqueId.split('-').map(Number);
    const company = currentCompanies[companyIdx];
    const contact = currentContacts[companyIdx][contactIdx];
    
    const modal = document.getElementById('contactModal');
    const content = document.getElementById('modal-content');
    
    content.innerHTML = `
        <div class="space-y-4">
            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg">
                <h4 class="font-bold text-lg mb-2">${contact.name}</h4>
                <p class="text-gray-700">${contact.title}</p>
                <p class="text-sm text-gray-600">${company.name}</p>
            </div>
            
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                <p class="font-semibold text-yellow-800 mb-2">
                    <i class="fas fa-exclamation-triangle mr-2"></i>
                    Antes de gastar cr√©ditos:
                </p>
                <a href="${contact.linkedin_url}" target="_blank" 
                   class="inline-block px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                    <i class="fab fa-linkedin mr-2"></i>
                    Revisar Perfil no LinkedIn Primeiro
                </a>
            </div>
            
            <button onclick="performDeepAnalysis('${uniqueId}')" 
                    class="w-full px-6 py-3 bg-gradient-to-r from-purple-600 to-red-600 text-white rounded-lg hover:from-purple-700 hover:to-red-700 font-bold text-lg">
                <i class="fas fa-rocket mr-2"></i>
                Executar An√°lise Profunda (Gasta Cr√©ditos)
            </button>
            
            <div id="analysis-result-${uniqueId}" class="hidden"></div>
        </div>
    `;
    
    modal.classList.remove('hidden');
}

// Step 3: Deep Analysis
async function performDeepAnalysis(uniqueId) {
    const [companyIdx, contactIdx] = uniqueId.split('-').map(Number);
    const company = currentCompanies[companyIdx];
    const contact = currentContacts[companyIdx][contactIdx];
    
    const resultDiv = document.getElementById(`analysis-result-${uniqueId}`);
    resultDiv.classList.remove('hidden');
    resultDiv.innerHTML = `
        <div class="mt-4 p-4 bg-gray-100 rounded-lg">
            <div class="flex items-center">
                <i class="fas fa-spinner fa-spin text-2xl text-indigo-600 mr-3"></i>
                <div>
                    <p class="font-semibold" id="analysis-status">Iniciando an√°lise...</p>
                    <div class="w-64 bg-gray-200 rounded-full h-2 mt-2">
                        <div id="analysis-progress" class="bg-indigo-600 h-2 rounded-full transition-all" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    try {
        // Update progress
        const updateProgress = (text, percent) => {
            document.getElementById('analysis-status').textContent = text;
            document.getElementById('analysis-progress').style.width = `${percent}%`;
        };
        
        // 1. Apollo Enrichment
        updateProgress('Enriquecendo com Apollo...', 25);
        const apolloRes = await fetch('/api/3-enrich-apollo', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ person: contact })
        });
        const apolloData = await apolloRes.json();
        
        // 2. Lusha Enrichment
        updateProgress('Buscando telefone com Lusha...', 50);
        const lushaRes = await fetch('/api/3-enrich-lusha', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                person: apolloData.person || contact,
                company: company.name
            })
        });
        const lushaData = await lushaRes.json();
        
        // 3. Serper Intel
        updateProgress('Coletando intelig√™ncia de mercado...', 75);
        const serperRes = await fetch('/api/3-intel-serper', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ company })
        });
        const serperData = await serperRes.json();
        
        // 4. Claude Analysis
        updateProgress('Analisando com IA...', 90);
        const claudeRes = await fetch('/api/4-analyze-claude', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                company,
                contact: {
                    ...contact,
                    ...apolloData.person,
                    phone: lushaData.phone
                },
                intel: serperData
            })
        });
        const analysis = await claudeRes.json();
        
        // Store results
        analysisResults[uniqueId] = {
            company,
            contact: {...contact, ...apolloData.person, phone: lushaData.phone},
            analysis,
            intel: serperData
        };
        
        // Update credits
        creditsUsed += 3; // Apollo + Lusha + Claude
        document.getElementById('credits-used').textContent = creditsUsed;
        
        // Display results
        displayAnalysisResults(uniqueId, analysisResults[uniqueId]);
        updateStepIndicator(3);
        
    } catch (error) {
        console.error('Analysis error:', error);
        resultDiv.innerHTML = `
            <div class="mt-4 p-4 bg-red-50 rounded-lg text-red-700">
                <i class="fas fa-exclamation-circle mr-2"></i>
                Erro na an√°lise: ${error.message}
            </div>
        `;
    }
}

// Display analysis results
function displayAnalysisResults(uniqueId, data) {
    const resultDiv = document.getElementById(`analysis-result-${uniqueId}`);
    const { contact, analysis } = data;
    
    const score = analysis.total_score || 0;
    const priority = analysis.priority || 'COLD';
    const priorityColor = priority === 'HOT' ? 'red' : priority === 'WARM' ? 'yellow' : 'gray';
    
    resultDiv.innerHTML = `
        <div class="mt-4 space-y-4">
            <!-- Contact Info -->
            <div class="bg-green-50 p-4 rounded-lg">
                <h5 class="font-bold mb-2">üìû Informa√ß√µes de Contato</h5>
                <div class="space-y-1">
                    ${contact.email ? `<p class="text-sm"><i class="fas fa-envelope mr-2"></i>${contact.email}</p>` : ''}
                    ${contact.phone ? `<p class="text-sm font-bold text-green-700"><i class="fas fa-phone mr-2"></i>${contact.phone}</p>` : '<p class="text-sm text-red-600"><i class="fas fa-times mr-2"></i>Telefone n√£o encontrado</p>'}
                </div>
            </div>
            
            <!-- PPVVC Analysis -->
            <div class="bg-white border-2 border-indigo-200 rounded-lg p-4">
                <div class="flex justify-between items-center mb-3">
                    <h5 class="font-bold">An√°lise PPVVC</h5>
                    <span class="px-3 py-1 bg-${priorityColor}-500 text-white rounded-full font-bold">
                        ${priority} - ${score}/10
                    </span>
                </div>
                
                <div class="grid grid-cols-3 gap-2 mb-3">
                    ${Object.entries(analysis.scores || {}).map(([key, value]) => `
                        <div class="text-center p-2 bg-gray-50 rounded">
                            <div class="text-xs font-semibold text-gray-600">${key.toUpperCase()}</div>
                            <div class="text-xl font-bold ${value >= 7 ? 'text-green-600' : value >= 5 ? 'text-yellow-600' : 'text-red-600'}">
                                ${value}/10
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <div class="bg-gray-50 p-3 rounded text-sm">
                    <p class="font-semibold mb-1">Justificativa:</p>
                    <p class="text-gray-700">${analysis.justification || 'N/A'}</p>
                </div>
                
                <div class="bg-purple-50 p-3 rounded mt-3">
                    <p class="font-semibold text-purple-900 mb-1">
                        <i class="fas fa-bullseye mr-2"></i>Abordagem Recomendada:
                    </p>
                    <p class="text-purple-800">${analysis.approach || 'N/A'}</p>
                </div>
                
                ${analysis.estimated_boxes_day ? `
                    <div class="text-center mt-3 pt-3 border-t">
                        <span class="text-sm text-gray-600">Volume Estimado:</span>
                        <span class="text-lg font-bold text-indigo-600 ml-2">${analysis.estimated_boxes_day} caixas/dia</span>
                    </div>
                ` : ''}
            </div>
        </div>
    `;
}

// Utility functions
function estimateBoxesPerDay(company) {
    const employees = company.estimated_num_employees || 100;
    const industry = (company.industry || '').toLowerCase();
    
    let multiplier = 1;
    if (industry.includes('logistics') || industry.includes('fulfillment') || industry.includes('ecommerce')) {
        multiplier = 3;
    } else if (industry.includes('manufacturing') || industry.includes('food')) {
        multiplier = 2;
    }
    
    return Math.round((employees / 10) * multiplier);
}

function updateStepIndicator(step) {
    for (let i = 1; i <= 3; i++) {
        const indicator = document.getElementById(`step${i}-indicator`);
        if (i <= step) {
            indicator.classList.remove('opacity-50');
            indicator.querySelector('div').classList.remove('bg-gray-300');
            indicator.querySelector('div').classList.add('bg-blue-600');
            indicator.querySelector('span').classList.remove('text-gray-500');
        }
    }
}

function closeModal() {
    document.getElementById('contactModal').classList.add('hidden');
}

function clearAll() {
    currentCompanies = [];
    currentContacts = {};
    analysisResults = {};
    creditsUsed = 0;
    document.getElementById('companies-container').classList.add('hidden');
    document.getElementById('credits-used').textContent = '0';
    updateStepIndicator(1);
}

function exportResults() {
    if (Object.keys(analysisResults).length === 0) {
        alert('Nenhuma an√°lise para exportar');
        return;
    }
    
    let csv = 'Empresa,Contato,Cargo,Email,Telefone,Score PPVVC,Prioridade,Abordagem\n';
    
    Object.values(analysisResults).forEach(result => {
        csv += `"${result.company.name}","${result.contact.name}","${result.contact.title || ''}","${result.contact.email || ''}","${result.contact.phone || ''}","${result.analysis.total_score}","${result.analysis.priority}","${result.analysis.approach || ''}"\n`;
    });
    
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `ventapel_prospects_${new Date().toISOString().split('T')[0]}.csv`;
    link.click();
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    updateStepIndicator(1);
});
</script>

</body>
</html>
